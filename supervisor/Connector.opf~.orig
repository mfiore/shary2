;; -*-Lisp-*-
;;author: Michelangelo Fiore
;;this module contains procedure to manage the connection between the
<<<<<<< HEAD
;;supervisor and the tablet. At the moment this is not safe and doesn't accout for other executions of the robot
=======
;;supervisor and the tablet
>>>>>>> 2716516a4eb14a47bb2f6ec3b0d468fd26a53c61

(
 (defop |sendMessage|
  :invocation (!(TabletConnector.sendMessage @message))
  :documentation "Sends a message to the tablet"
  :body (
	 (?(TabletConnector.tabletName @name))
  	(!(SEND-MESSAGE @name @message))	
	)
  )

(defop |sendStringMessage|
  :invocation (!(TabletConnector.sendStringMessage @message))
  :documentation "sends a message to the tablet in string format"
  :body (
	 (?(TabletConnector.tabletName @name))
  	(!(SEND-STRING @name @message))	
	 )
  )


(defop |getCommand|
  :invocation (!(TabletConnector.getCommand))
  :body (
	 (!(= @id 1))
	 (WHILE(?(TabletConnector.shouldRun TRUE))
	       (^(order @command))
<<<<<<< HEAD
	       (~> (order (VAL @command)))x
=======
	       (~> (order (VAL @command)))
>>>>>>> 2716516a4eb14a47bb2f6ec3b0d468fd26a53c61
	       (!(= @idStr (TERM-STRING-CAT @id)))  
	       (!(= @id (+ @id 1)))
	       (IF(?(EQUAL @command stop))
		  (!(TabletConnector.sendMessage (order stop))) 
		  (=>(TabletConnector.shouldRun FALSE))
		  
		  ELSEIF(?(EQUAL @command take))
		  (^(parameter name @objectName))
		  (~>(parameter name (VAL @objectName)))
	
	
<<<<<<< HEAD
		  (=>(PlanManager.goal TakeObject (. PR2_ROBOT (VAL @objectName) META_TABLE .)))
		  (=>(PlanManager.newGoal TRUE))
		  (=>(PlanManager.managePlans))
		  (^(PlanManager.report @report))
		  (~>(PlanManager.report (VAL @report)))
=======
		  (!(= @message (PlanManager.goal Take )))
		  (^(ELAPSED-TIME (TIME) 5))
		  (!(SEND-MESSAGE ONTO_OPRS_INTERFACE @message))
>>>>>>> 2716516a4eb14a47bb2f6ec3b0d468fd26a53c61

		  (!(TabletConnector.sendMessage (order stop))) 
		  (^(order stop))
		  (~>(order stop))
		  
		  ELSEIF(?(EQUAL @command drop))
		  (^(parameter name @placementName))
		  (~>(parameter name (VAL @placementName)))

<<<<<<< HEAD
		  (IF(?(Robot.hasObject RIGHT @objectName))
		     (=>(PlanManager.goal ThrowObject (. PR2_ROBOT (VAL @objectName) PINK_TRASHBIN .)))
		     (=>(PlanManager.newGoal TRUE))
		     (=>(PlanManager.managePlans))
		     (^(PlanManager.report @report))
		     (~>(PlanManager.report (VAL @report)))
		     )
=======
		  (!(= @goalStr (STRING-CAT "Drop" @idStr)))
		  (!(= @goal (MAKE-ATOM @goalStr)))
		  
		  (IF(?(EQUAL @placementName TABLE))
		     (!(= @message (ONTO_ADD_FOR_AGENT GOAL_CREATER 0 PR2_ROBOT (. (STATEMENT (VAL @goal) rdf@@type PutObject) (STATEMENT (VAL @goal) actsOnObject GREY_TAPE) (STATEMENT (VAL @goal) performedBy PR2_ROBOT) (STATEMENT (VAL @goal) onSupport META_TABLE) (STATEMENT HERAKLES_HUMAN1 desires (VAL @goal)) .) )))
		     
		     ELSE
		     (!(= @message (ONTO_ADD_FOR_AGENT GOAL_CREATER 0 PR2_ROBOT (. (STATEMENT (VAL @goal) rdf@@type ThrowObject) (STATEMENT (VAL @goal) actsOnObject GREY_TAPE) (STATEMENT (VAL @goal) performedBy PR2_ROBOT) (STATEMENT (VAL @goal) inTrashbin PINK_TRASHBIN) (STATEMENT HERAKLES_HUMAN1 desires (VAL @goal)) .) )))
		     
		     )
		  (^(ELAPSED-TIME (TIME) 5))
		  (!(SEND-MESSAGE ONTO_OPRS_INTERFACE @message))

>>>>>>> 2716516a4eb14a47bb2f6ec3b0d468fd26a53c61

		  (!(TabletConnector.sendMessage (order stop))) 
		  (^(order stop))
		  (~>(order stop))

		  ELSEIF(?(EQUAL @command clean))
		 
<<<<<<< HEAD
		  (=>(PlanManager.goal Clean (. META_TABLE .)))
		  (=>(PlanManager.newGoal TRUE))
		  (=>(PlanManager.managePlans))
		  
		  (^(PlanManager.report (VAL @report)))
		  (~>(PlanManager.report @report))
=======
		  (!(= @goalStr (STRING-CAT "Clean" @idStr)))
		  (!(= @goal (MAKE-ATOM @goalStr)))
		  (!(= @message (ONTO_ADD_FOR_AGENT GOAL_CREATER 0 PR2_ROBOT (. (STATEMENT (VAL @goal) rdf@@type Clean) (STATEMENT (VAL @goal) actsOnObject META_TABLE) (STATEMENT (VAL @goal) performedBy PR2_ROBOT) (STATEMENT HERAKLES_HUMAN1 desires (VAL @goal)) .) )))
		     
		     
		  (^(ELAPSED-TIME (TIME) 5))
		  (!(SEND-MESSAGE ONTO_OPRS_INTERFACE @message))

>>>>>>> 2716516a4eb14a47bb2f6ec3b0d468fd26a53c61

		  (!(TabletConnector.sendMessage (order stop))) 
		  (^(order stop))
		  (~>(order stop))	

	  
		  ELSEIF(?(EQUAL @command list))
		  (^(parameter type @listType))
		  (~>(parameter type (VAL @listType)))
		  (IF(?(EQUAL @listType objects))
		     (!(TabletConnector.sendMessage (GREY_TAPE LOTR_TAPE WALLE_TAPE)))
		     ELSEIF(?(EQUAL @listType places))
		     (!(TabletConnector.sendMessage (PINK_TRASHBIN TABLE)))
		     )
		  )
	       )
	 )
  )




)
